<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.ss.useditems.mapper.ItemViewMapper">
	<resultMap type="itemDTO" id="itemMap">
		<result property="item_index" column="item_index" />
		<result property="item_seller" column="item_seller" />
		<result property="item_title" column="item_title" />
		<result property="item_content" column="item_content" />
		<result property="item_image" column="item_image" />
		<result property="item_category" column="item_category" />
		<result property="item_price" column="item_price" />
		<result property="item_place" column="item_place" />
		<result property="item_status" column="item_status" />
		<result property="item_enrollDate" column="item_enrollDate" />
		<result property="item_click" column="item_click" />
		<result property="item_interest" column="item_interest" />
		<result property="item_offDate" column="item_offDate" />
		<result property="item_buyer" column="item_buyer" />
	</resultMap>

	<resultMap type="memberDTO" id="memberMap">
		<result property="acc_index" column="acc_index" />
		<result property="acc_id" column="acc_id" />
		<result property="acc_password" column="acc_password" />
		<result property="acc_birthDate" column="acc_birthDate" />
		<result property="acc_phone" column="acc_phone" />
		<result property="acc_name" column="acc_name" />
		<result property="acc_address" column="acc_address" />
		<result property="acc_nickname" column="acc_nickname" />
		<result property="acc_profile" column="acc_profile" />
		<result property="acc_level" column="acc_level" />
		<result property="acc_count" column="acc_count" />
		<result property="acc_status" column="acc_status" />
		<result property="acc_enrollDate" column="acc_enrollDate" />
	</resultMap>

	<resultMap type="memberDTO" id="itemDetailMap"
		extends="itemMap">
		<collection property="acc_index" resultMap="memberMap"
			columnPrefix="a._" />
	</resultMap>

	<resultMap type="replyDTO" id="replyMap">
		<result property="repl_index" column="repl_index" />
		<result property="repl_item" column="repl_item" />
		<result property="repl_candidate" column="repl_candidate" />
		<result property="repl_nickname" column="repl_nickname" />
		<result property="repl_content" column="repl_content" />
		<result property="repl_enrolldate" column="repl_enrolldate" />
	</resultMap>

	<resultMap type="itemInfoDTO" id="itemInfoMap"
		extends="itemMap">
		<result property="acc_nickname" column="acc_nickname" />
		<result property="acc_address" column="acc_address" />
		<result property="acc_level" column="acc_level" />
		<result property="show_thumb" column="show_thumb" />
		<result property="show_img1" column="show_img1" />
		<result property="show_img2" column="show_img2" />
		<result property="show_img3" column="show_img3" />
		<result property="show_img4" column="show_img4" />
		<result property="show_img5" column="show_img5" />
	</resultMap>

	<select id="selectByItemIndex" parameterType="int"
		resultMap="itemInfoMap">
		SELECT * FROM item i JOIN showcase s ON s.show_item =
		i.item_index WHERE item_index = #{item_index}
	</select>

	<select id="selectByIndex" parameterType="int"
		resultMap="memberMap">
		SELECT * FROM ACCOUNT WHERE acc_index = #{item_seller}
	</select>

	<insert id="insertReply" parameterType="ReplyDTO">
		insert into reply(repl_index, repl_item, repl_candidate,repl_nickname,
		repl_content, repl_enrolldate)
		values(REPLY_SEQ.NEXTVAL, #{repl_item}, #{repl_candidate},#{repl_nickname,jdbcType=VARCHAR},
		#{repl_content,jdbcType=VARCHAR}, DEFAULT)
	</insert>

	<select id="selectReplyByItemIndex" parameterType="int"
		resultMap="replyMap">
		SELECT * FROM reply WHERE repl_item = #{item_index}
	</select>

    <update id="incrementViews" >
        UPDATE item
        SET item_click = item_click + 1
        WHERE item_index = #{itemId}
    </update>
    

    <select id="interestnum" parameterType="int">
    	select count(*) from interest where int_item = #{item_index} 
    </select>
    
		<delete id="deleteReply" parameterType="map">
			<if test="replyNo != null">delete from reply where repl_index = ${replyNo}</if>
			<if test="itemNo != null">delete from reply where item_index = ${itemNo}</if>
	</delete>

	<update id="updateReply" parameterType="ReplyDTO">
	    UPDATE reply
	    SET repl_content = #{repl_content}
	    WHERE repl_index = #{repl_index}
	</update>
</mapper>