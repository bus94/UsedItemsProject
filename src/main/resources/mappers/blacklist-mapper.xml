<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.ss.useditems.mapper.BlacklistMapper">

	<resultMap type="BlacklistDTO" id="blacklistMap">
		<result property="black_index" column="black_index" />
		<result property="black_subject" column="black_subject" />
		<result property="black_object" column="black_object" />
		<result property="black_content" column="black_content" />
		<result property="black-enrolldate" column="black-enrolldate" />
	</resultMap>

	<resultMap type="BlacklistDTO" id="blacklistDetailMap"
		extends="blacklistMap">
		<result property="subject_nickname" column="subject_nickname" />
		<result property="subject_id" column="subject_id" />
		<result property="object_nickname" column="object_nickname" />
		<result property="object_id" column="object_id" />
	</resultMap>



	<select id="getBlacklist" parameterType="map"
		resultMap="blacklistDetailMap">
		select
		branch.black_index,
		branch.black_subject,
		branch.subject_nickname,
		branch.subject_id,
		branch.black_object,
		obj.acc_nickname object_nickname,
		obj.acc_id object_id,
		branch.black_content,
		branch.black_enrolldate
		from
		(select
		stem.black_index,
		stem.black_subject,
		acc.acc_nickname subject_nickname,
		acc.acc_id subject_id,
		stem.black_object,
		stem.black_content,
		stem.black_enrolldate
		from BLACKLIST stem
		join ACCOUNT acc on (stem.black_subject = acc.acc_index)) branch
		join
		(select
		stem.black_index,
		acc.acc_nickname,
		acc.acc_id
		from BLACKLIST stem
		join ACCOUNT acc on (stem.black_object = acc.acc_index)) obj
		on (branch.black_index = obj.black_index)
		where branch.black_index >= 1
		<if test="black_object != null">
			and obj.acc_id='${black_object}'
		</if>
		<if test="acc_nickname != null">
			and obj.acc_nickname like '%${acc_nickname}%'
			or subject_nickname like '%${acc_nickname}%'
		</if>
		<if test="acc_id != null">
			and obj.acc_id like '%${acc_id}%'
			or subject_id like'%${acc_id}%'
		</if>
		<if test="content != null">
			and black_content like '%${content}%'
		</if>
		order by black_index desc
	</select>




</mapper>